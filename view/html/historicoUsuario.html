<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=0.3">
    <title>Histórico</title>
    <link rel="stylesheet" href="../css/historicoUsuario.css" media="screen" />

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- amCharts -->
    <script src="https://cdn.amcharts.com/lib/5/index.js"></script>
    <script src="https://cdn.amcharts.com/lib/5/percent.js"></script>
    <script src="https://cdn.amcharts.com/lib/5/themes/Animated.js"></script>
</head>
<body>
    <div class="faixa"> 
        <button class="btn-voltar" id="btnVoltar" type="button">&lt;</button>
    </div>

    <!-- Seção do Gráfico -->
    <div id="chartdiv"></div>
    <style> 
        #chartdiv {
            width: 120%;
            height: 500px;
        }
    </style>

    <!-- Carousel do Bootstrap -->
    <div id="slide" class="carousel slide" data-bs-ride="carousel" data-bs-interval="4000" data-bs-pause="hover" data-bs-wrap="true">
        <div class="carousel-inner" id="carouselContent">
            <!-- Conteúdo será injetado via JavaScript -->
        </div>
        <!-- Controles do Carousel -->
        <button class="carousel-control-prev" type="button" data-bs-target="#slide" data-bs-slide="prev">
            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
            <span class="visually-hidden">Anterior</span>
        </button>
        <button class="carousel-control-next" type="button" data-bs-target="#slide" data-bs-slide="next">
            <span class="carousel-control-next-icon" aria-hidden="true"></span>
            <span class="visually-hidden">Próximo</span>
        </button>
    </div>

    <!-- Seção de Links Finais -->
    <div class="fim text-center mt-4">
        <a class="sobrecaixabaixa me-3" href="../html/sobrenos.html">Sobre nós</a>
        <a class="sobreprojeto ms-3" href="../html/sobreprojeto.html">Sobre o projeto</a>
    </div>

    <!-- Scripts Bootstrap e amCharts -->
    <!-- Bootstrap JS Bundle (Inclui Popper) -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

    <script>
       const emailUsuario = localStorage.getItem("emailUsuario");
       let pontosUsuarios = null;
       
        function processarPontos  () { 
            const rota = `/respostas `

            fetch(rota, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(emailUsuario) // envia o objeto com os pontos e o email
            }).then((response) => {
                return response.json();
            }).then((data) => {
                if (response.status == true) {
                    pontosUsuarios = data.dados
                } else {
                    console.error("Erro ao buscar os pontos do banco");
                }
            }).catch((error) => {
                console.log("Error ao buscar categorias:", error);
            });
                 
        }
        document.addEventListener('DOMContentLoaded', async function () {
           

            if (emailUsuario) {
                try {
                    processarPontos ()
                } catch (error) {
                    console.error("Erro na requisição fetch:", error);
                }
            } else {
                pontosUsuarios = JSON.parse(localStorage.getItem("pontos"));
            }

            if (pontosUsuarios) {
                var root = am5.Root.new("chartdiv");

                root.setThemes([
                    am5themes_Animated.new(root)
                ]);

                var chart = root.container.children.push(am5percent.PieChart.new(root, {
                    layout: root.verticalLayout
                }));

                var series = chart.series.push(am5percent.PieSeries.new(root, {
                    valueField: "value",
                    categoryField: "category"
                }));

                var data = [];

                if (pontosUsuarios.Pontos_Eletronica > 0) {
                    data.push({ value: pontosUsuarios.Pontos_Eletronica, category: "Eletrônica" });
                }
                if (pontosUsuarios.Pontos_Informatica > 0) {
                    data.push({ value: pontosUsuarios.Pontos_Informatica, category: "Informática" });
                }
                if (pontosUsuarios.Pontos_Analises_Clinicas > 0) {
                    data.push({ value: pontosUsuarios.Pontos_Analises_Clinicas, category: "Análises Clínicas" });
                }
                if (pontosUsuarios.Pontos_Quimica > 0) {
                    data.push({ value: pontosUsuarios.Pontos_Quimica, category: "Química" });
                }
                if (pontosUsuarios.Pontos_Publicidade > 0) {
                    data.push({ value: pontosUsuarios.Pontos_Publicidade, category: "Publicidade" });
                }
                if (pontosUsuarios.Pontos_Administracao > 0) {
                    data.push({ value: pontosUsuarios.Pontos_Administracao, category: "Administração" });
                }

                series.data.setAll(data);

                // Montagem do carousel com base nos pontos
                const carouselContent = document.getElementById("carouselContent");
                let activeSet = false;

                const cursos = [
                    {
                        pontos: pontosUsuarios.Pontos_Informatica,
                        imagem: "../html/logos/informatica.jpeg",
                        nome: "INFORMÁTICA",
                        descricao: "O curso de informática oferece aos seus alunos um vasto conhecimento para desenvolver programas em diversas linguagens de programações que acompanham as tendências tecnológicas e do mercado de trabalho. Possibilitar o profissional formado atuar em empresas comerciais, industriais, instituições de pesquisas e até mesmo como microempresário individual. Neste curso o aluno é direcionado a pesquisar, entender, aplicar e aprender técnicas avançadas de programação, que podem ser utilizadas no desenvolvimento de softwares voltados para o gerenciamento da informação por meio de banco de dados, computação e animação gráfica, técnicas básicas de desenvolvimentos de jogos e programação para internet (sites)."
                    },
                    {
                        pontos: pontosUsuarios.Pontos_Eletronica,
                        imagem: "../html/logos/eletronica.jpeg",
                        nome: "ELETRÔNICA",
                        descricao: "O Curso Técnico em Eletrônica possui um currículo que atende às necessidades do mercado, formando profissionais aptos para atuar com competência nesse setor. Um dos objetivos do curso é formar um profissional que participe do desenvolvimento de projetos. Executa a instalação e a manutenção de equipamentos e sistemas eletrônicos e de automação. Realiza medições e testes com equipamentos eletrônicos. Executa procedimentos de controle de qualidade e gestão da produção de equipamentos eletrônicos dentre outras atuações essenciais do mercado."
                    },
                    {
                        pontos: pontosUsuarios.Pontos_Administracao,
                        imagem: "../html/logos/admin.jpeg",
                        nome: "ADMINISTRAÇÃO",
                        descricao: "Administrar, planejar, organizar e controlar as atividades empresariais, a fim de compreender a análise da produtividade, rentabilidade e controle de resultados. Esses são alguns dos objetivos do curso de Técnico em Administração de Empresas, nos quais o aluno busca motivação para o estudo da administração pública e privada de pequenas, médias e grandes empresas e de toda a complexa realidade que as envolve."
                    },
                    {
                        pontos: pontosUsuarios.Pontos_Analises_Clinicas,
                        imagem: "../html/logos/analises.jpeg",
                        nome: "ANÁLISES CLÍNICAS",
                        descricao: " O Curso Técnico em Análises Clínicas foi implantado para atender às necessidades na área das investigações médicas e biológicas. Prepara profissionais de nível médio com formação específica em Análises Clínicas, orientados e treinados para ocuparem postos em laboratórios, além de trabalharem no desenvolvimento de pesquisas acadêmicas."
                    },
                    {
                        pontos: pontosUsuarios.Pontos_Quimica,
                        imagem: "../html/logos/quimica.jpeg",
                        nome: "QUÍMICA",
                        descricao: "Desenvolver competências para analisar, pesquisar e produzir materiais e processos químicos nos setores de alimentos, farmácia, cosméticos, petroquímicos e de controle ambiental. Sempre ampliando os limites do conhecimento teórico e científico dos nossos alunos para atender à demanda por bens e serviços mais adequados ao homem e ao meio ambiente."
                    },
                    {
                        pontos: pontosUsuarios.Pontos_Publicidade,
                        imagem: "../html/logos/publicidade.jpeg",
                        nome: "PUBLICIDADE",
                        descricao: " O Curso Técnico em Publicidade busca integrar esforços coletivos para tornar o aluno apto a desenvolver a criatividade, o espírito inventivo, sua própria concepção em relação a produtos e serviços. O domínio do processo de produção através da criação e do marketing, a pesquisa de mercado, mídias e a produção gráfica audiovisual são os principais focos dos nossos alunos."
                    }
                ];

                cursos.forEach((curso, index) => {
                    if (curso.pontos > 0) {
                        const carouselItem = document.createElement("div");
                        carouselItem.classList.add("carousel-item");
                        if (!activeSet) {
                            carouselItem.classList.add("active");
                            activeSet = true;
                        }

                        carouselItem.innerHTML = `
                            <div class="imagem text-center">
                                <img src="${curso.imagem}" width="120" height="120" alt="${curso.nome}">
                            </div>
                            <div class="text-center fw-bold">${curso.nome}</div>
                            <p>${curso.descricao}</p>
                        `;

                        carouselContent.appendChild(carouselItem);
                    }
                });
            }
        });
    </script>
</body>
</html>